<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeetCode AI Coach Panel</title>
    <link rel="stylesheet" href="sidepanel.css">
</head>

<body class="bg-primary text-primary antialiased flex flex-col overflow-hidden" style="height: 100vh;">

    <!-- Header -->
    <header
        class="glass-header p-4 flex items-center justify-between border-b border-subtle z-10 shrink-0 shadow-sm relative">
        <div class="flex items-center gap-3">
            <!-- New Logo Injection -->
            <svg width="24" height="24" viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg">
                <!-- Background is removed for transparent glass look -->
                <!-- Main A shape -->
                <path
                    d="M200 60 L90 300 Q80 320 100 320 L150 320 Q170 320 180 300 L200 250 L220 300 Q230 320 250 320 L300 320 Q320 320 310 300 Z"
                    fill="currentColor" class="text-accent" />
                <!-- Curved side arms -->
                <path d="M90 300 Q40 260 70 220 Q100 190 130 240" fill="currentColor" class="text-accent" />
                <path d="M310 300 Q360 260 330 220 Q300 190 270 240" fill="currentColor" class="text-accent" />
                <!-- Inner cut triangle -->
                <path d="M200 140 L140 260 Q200 230 260 260 Z" fill="var(--bg-primary)" />
                <!-- Center star -->
                <polygon points="200,185 210,210 235,210 215,225 225,250 200,235 175,250 185,225 165,210 190,210"
                    fill="var(--text-primary)" />
            </svg>
            <div>
                <h1 class="text-base font-bold leading-tight flex items-center gap-2">
                    AI Coach
                    <span id="headerUsername"
                        class="text-[10px] bg-subtle text-dim px-1.5 py-0.5 rounded uppercase hidden">Not Logged
                        In</span>
                </h1>
                <p class="text-[11px] text-muted font-medium" id="headerContext">Listening for LeetCode</p>
            </div>
        </div>
        <div class="flex gap-2">
            <button id="themeToggle" class="icon-btn" title="Toggle theme">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5" />
                    <path
                        d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
                </svg>
            </button>
        </div>
    </header>

    <!-- Tabs Nav -->
    <nav class="flex px-4 pt-3 border-b border-subtle shrink-0">
        <button class="tab-btn active" data-target="tab-analysis">Analysis</button>
        <button class="tab-btn" data-target="tab-similar">Similar</button>
        <button class="tab-btn" data-target="tab-stats">Stats</button>
    </nav>

    <!-- Content Area (Scrollable) -->
    <main class="flex-1 overflow-hidden relative flex flex-col min-h-0" id="mainContainer">

        <!-- Tab 1: Analysis -->
        <section id="tab-analysis" class="tab-pane active flex flex-col h-full w-full overflow-y-auto custom-scrollbar">
            <div class="max-w-[750px] mx-auto w-full flex flex-col min-h-full relative">
                <div id="noProblemState" class="text-center p-8 hidden flex-col items-center justify-center flex-1">
                    <p class="text-sm text-dim">Open a LeetCode problem to get started.</p>
                    <button id="refreshContextBtn" class="mt-4 btn-primary px-4 py-2">Refresh Context</button>
                </div>

                <div id="analysisState" class="hidden flex-col w-full flex-1">
                    <!-- Problem Context Banner -->
                    <div class="px-4 pt-4 shrink-0">
                        <div
                            class="bg-card rounded-lg p-3 border border-subtle flex justify-between items-center shadow-sm">
                            <div class="font-medium text-sm truncate pr-2" id="probName">Unknown</div>
                            <div class="diff-badge" id="probDiff">Easy</div>
                        </div>
                    </div>

                    <!-- Chat History Area -->
                    <div id="chatHistory" class="flex flex-col gap-4 p-4 text-left flex-1">
                        <div class="text-center text-xs text-dim mt-2">Read your code and click Analyze below.</div>
                        <!-- Chat bubbles will go here -->
                    </div>

                    <!-- Footer Analyze Button (Scrolls naturally at bottom) -->
                    <div class="p-4 shrink-0 mt-auto">
                        <button id="analyzeBtn"
                            class="btn-primary w-full py-2.5 shadow-glow flex items-center justify-center gap-2 text-sm transition">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <circle cx="11" cy="11" r="8" />
                                <path d="m21 21-4.35-4.35" />
                            </svg>
                            Analyze Latest Code
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tab 2: Similar -->
        <section id="tab-similar" class="tab-pane hidden flex-col h-full overflow-y-auto p-4 custom-scrollbar min-h-0">
            <div id="similarLoading" class="hidden py-8 text-center">
                <div class="spinner mx-auto mb-3"></div>
            </div>
            <div id="similarEmpty" class="text-center py-8 hidden flex-col items-center">
                <p class="text-sm text-dim mb-4">No similar problems found or not on a problem page.</p>
                <button id="retrySimilarBtn" class="btn-primary px-3 py-1.5 text-xs">Retry Fetching</button>
            </div>
            <div id="similarContent" class="flex flex-col gap-3">
                <!-- Injected via JS -->
            </div>
        </section>

        <!-- Tab 3: Stats -->
        <section id="tab-stats" class="tab-pane hidden flex-col h-full overflow-y-auto p-4 custom-scrollbar">
            <div class="max-w-[750px] mx-auto w-full flex flex-col">
                <div id="statsLoading" class="hidden py-8 text-center">
                    <div class="spinner mx-auto mb-3"></div>
                </div>

                <!-- Username Input Fallback -->
                <div id="statsUsernameFallback"
                    class="hidden text-center py-6 bg-card border border-subtle rounded-lg p-4 mb-4">
                    <p class="text-xs text-dim mb-3">Auto-detect failed. Please enter your LeetCode username:</p>
                    <div class="flex gap-2">
                        <input type="text" id="manualUsername"
                            class="flex-1 bg-secondary text-primary border border-subtle rounded px-2 py-1.5 text-sm outline-none focus:border-accent"
                            placeholder="Username">
                        <button id="saveUsernameBtn"
                            class="bg-accent text-primary-inv font-bold rounded px-3 text-sm">Save</button>
                    </div>
                </div>

                <div id="statsContent" class="flex flex-col gap-4 hidden">

                    <!-- Top: Circular Chart & Counts -->
                    <div class="bg-card rounded-xl border border-subtle shadow-sm p-4 flex gap-5 items-center">
                        <!-- Left: Circular SVG Chart -->
                        <div class="relative w-[100px] h-[100px] shrink-0 flex items-center justify-center">
                            <!-- Chart container -->
                            <svg class="w-full h-full transform -rotate-90 absolute top-0 left-0" viewBox="0 0 100 100">
                                <circle cx="50" cy="50" r="45" fill="transparent" stroke="var(--bg-secondary)"
                                    stroke-width="4"></circle>
                                <circle id="ringEasy" cx="50" cy="50" r="45" fill="transparent" stroke="var(--easy)"
                                    stroke-width="4" stroke-dasharray="282.7" stroke-dashoffset="282.7"
                                    stroke-linecap="round"></circle>
                                <circle id="ringMed" cx="50" cy="50" r="45" fill="transparent" stroke="var(--medium)"
                                    stroke-width="4" stroke-dasharray="282.7" stroke-dashoffset="282.7"
                                    stroke-linecap="round" class="origin-center transition-all duration-1000"></circle>
                                <circle id="ringHard" cx="50" cy="50" r="45" fill="transparent" stroke="var(--hard)"
                                    stroke-width="4" stroke-dasharray="282.7" stroke-dashoffset="282.7"
                                    stroke-linecap="round" class="origin-center transition-all duration-1000"></circle>
                            </svg>
                            <div class="z-10 flex flex-col items-center justify-center text-center">
                                <div class="text-xl font-black text-primary leading-tight" id="statTotalSvg">--</div>
                                <div class="text-[9px] text-dim font-semibold uppercase">Solved</div>
                            </div>
                        </div>
                        <!-- Right: Easy, Med, Hard Count Blocks (like image 2) -->
                        <div class="flex flex-col flex-1 gap-2">
                            <div class="bg-secondary rounded p-2 flex justify-between items-center"><span
                                    class="text-xs text-easy font-bold">Easy</span> <span
                                    class="text-xs font-semibold text-primary" id="cntEasy">--</span></div>
                            <div class="bg-secondary rounded p-2 flex justify-between items-center"><span
                                    class="text-xs text-medium font-bold">Med.</span> <span
                                    class="text-xs font-semibold text-primary" id="cntMed">--</span></div>
                            <div class="bg-secondary rounded p-2 flex justify-between items-center"><span
                                    class="text-xs text-hard font-bold">Hard</span> <span
                                    class="text-xs font-semibold text-primary" id="cntHard">--</span></div>
                        </div>
                    </div>

                    <!-- Middle: Rating / Standings -->
                    <div class="bg-card rounded-xl border border-subtle shadow-sm p-4 relative overflow-hidden">
                        <div class="text-xs text-dim font-bold uppercase mb-2">Contest Rating</div>
                        <div class="flex items-end justify-between relative z-10">
                            <div class="text-3xl font-black text-primary" id="statRating2">--</div>
                            <div class="text-xs text-warning font-semibold bg-warning bg-opacity-10 px-2 py-1 rounded"
                                id="statGlobalRanking">Top --%</div>
                        </div>
                        <!-- decorative background seal -->
                        <div class="absolute -bottom-4 -right-4 text-5xl opacity-5 dropdown-icon font-emoji">üèÜ</div>
                    </div>

                    <!-- Bottom: Submissions Calendar Grid -->
                    <div class="bg-card rounded-xl border border-subtle shadow-sm p-4 overflow-hidden">
                        <div class="flex justify-between items-end mb-4">
                            <div>
                                <span class="text-lg font-bold text-primary" id="statTotalSubs">--</span>
                                <span class="text-[10px] text-dim font-medium ml-1">submissions in past year</span>
                            </div>
                            <div class="text-right text-[10px] text-dim flex flex-col items-end gap-0.5">
                                <div>Active days: <span class="text-primary font-bold ml-1"
                                        id="statActiveDays">--</span></div>
                                <div>Max streak: <span class="text-primary font-bold ml-1"
                                        id="statStreakExact">--</span></div>
                            </div>
                        </div>
                        <div class="w-full overflow-x-auto custom-scrollbar pb-2">
                            <div id="calendarHeatmap" class="flex gap-1" style="min-width: max-content;">
                                <!-- Map columns injected via JS -->
                            </div>
                        </div>
                    </div>

                    <!-- Topic Bubbles -->
                    <div class="bg-card rounded-xl border border-subtle shadow-sm p-4">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-xs text-dim font-semibold uppercase">Topic Mastery</span>
                            <span class="text-xs font-black text-success" id="statAcceptance">--%</span>
                        </div>
                        <div id="topicBubbles" class="flex flex-wrap gap-2 justify-center py-2">
                            <!-- Bubbles injected via JS -->
                        </div>
                    </div>

                </div>
            </div>
        </section>

    </main>

    <script src="sidepanel.js"></script>
</body>

</html>